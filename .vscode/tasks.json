{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "Disable Apple Developer Services Domain",
      "type": "shell",
      "command": "print \"127.0.0.1 http://developerservices2.apple.com\" | sudo tee -a /etc/hosts > /dev/null",
      "problemMatcher": [],
      "presentation": { "close": true }
    },
    {
      "label": "Enable Apple Developer Services Domain",
      "type": "shell",
      "command": "sudo sed -i '' '/developerservices2.apple.com/d' /etc/hosts",
      "problemMatcher": [],
      "presentation": { "close": true }
    },
    {
      "type": "shell",
      "label": "Build",
      "dependsOrder": "sequence",
      "dependsOn": ["Run Build Script", "Restart Swift LSP Server"],
      "group": { "kind": "build", "isDefault": true }
    },
    {
      "label": "Run Build Script",
      "type": "shell",
      "command": "${workspaceFolder}/Scripts/build.sh",
      "problemMatcher": [
        {
          "owner": "swift",
          "fileLocation": ["relative", "${workspaceRoot}"],
          "applyTo": "allDocuments",
          "pattern": { "regexp": "", "line": 1 },
          "background": {
            "activeOnStart": true,
            "beginsPattern": "^Resolving Package Graph",
            "endsPattern": "^(Build Succeeded|\\*\\* BUILD FAILED \\*\\*|\\*\\* BUILD INTERRUPTED \\*\\*)$"
          }
        },
        {
          "owner": "swift",
          "fileLocation": ["absolute"],
          "pattern": {
            "regexp": "^(?:❌|\\[x\\])\\s*(\\/[^:]+):(\\d+):(\\d+):\\s*(.*)$",
            "file": 1,
            "line": 2,
            "column": 3,
            "message": 4
          },
          "severity": "error"
        },
        {
          "owner": "swift",
          "fileLocation": ["absolute"],
          "pattern": {
            "regexp": "^(?:⚠️|\\[!\\])\\s*(\\/[^:]+):(\\d+):(\\d+):\\s*(.*)$",
            "file": 1,
            "line": 2,
            "column": 3,
            "message": 4
          },
          "severity": "warning"
        }
      ],
      "presentation": {
        "panel": "dedicated",
        "echo": false,
        "showReuseMessage": false
      }
    },
    {
      "label": "Restart Swift LSP Server",
      "command": "${command:swift.restartLSPServer}"
    },
    {
      "label": "Stream Log",
      "type": "shell",
      "command": "${workspaceFolder}/scripts/log_formatter.sh ${workspaceFolder}/DerivedData/Build/Products/Debug/${config:appName}.app/Contents/MacOS/${config:appName} ${config:bundleID}",
      "problemMatcher": [],
      "isBackground": true,
      "presentation": {
        "panel": "dedicated",
        "echo": false,
        "showReuseMessage": false
      }
    },
    {
      "label": "Delete Derived Data",
      "type": "shell",
      "command": "rm -rf ${workspaceFolder}/DerivedData",
      "problemMatcher": [],
      "presentation": { "close": true }
    },
    {
      "label": "Reset Permissions",
      "type": "shell",
      "command": "tccutil reset All ${config:bundleID}",
      "problemMatcher": [],
      "presentation": { "close": true }
    },
    {
      "label": "Reset Defaults",
      "type": "shell",
      "command": "defaults delete ${config:bundleID}",
      "problemMatcher": [],
      "presentation": { "close": true }
    },
    {
      "label": "Release",
      "type": "shell",
      "command": "${workspaceFolder}/Scripts/release.sh",
      "problemMatcher": [],
      "presentation": { "echo": false, "showReuseMessage": false }
    }
  ]
}
